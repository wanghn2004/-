## 一、前置条件（需提前准备）

1. 已安装并启动 MinIO 服务端（知道服务端 **IP、端口、Access Key、Secret Key**，默认端口 9000，默认密钥 `minioadmin/minioadmin`）；
2. 服务器是 openEuler 22.03（64 位 x86_64），内网环境（无外网，需离线部署工具）；
3. 已关闭防火墙（之前已操作，避免端口拦截）。

## 二、步骤 1：离线部署 MinIO 命令行工具 `mc`（核心工具）

`mc` 是 MinIO 官方命令行客户端，所有桶配置都依赖它，需先离线部署：

### 1.1 外网下载 `mc` 二进制包

用外网机器下载适配 Linux 64 位的 `mc`（与 openEuler 架构匹配）：

- 官方下载地址：https://dl.min.io/client/mc/release/linux-amd64/mc
- 备用镜像地址：https://mirror.ghproxy.com/https://github.com/minio/mc/releases/latest/download/mc-linux-amd64

### 1.2 传输 `mc` 到内网服务器

通过 U 盘、内网传输工具（如 SCP），将下载的 `mc` 文件拷贝到内网服务器的 `/usr/local/bin` 目录（方便全局调用）：

```bash
# 示例：U 盘挂载后拷贝（根据实际 U 盘路径修改）
cp /mnt/usb/mc /usr/local/bin/
```

### 1.3 赋予 `mc` 执行权限

```bash
chmod +x /usr/local/bin/mc
```

### 1.4 验证 `mc` 部署成功

```bash
mc --version
```

输出类似 `mc version RELEASE.2024-xx-xxTxx:xx:xxZ (commit-id:xxxx)` 即成功。

## 二、步骤 2：用 `mc` 连接 MinIO 服务端

部署完 `mc` 后，需先让 `mc` 与 MinIO 服务端建立连接（相当于 “绑定” 服务端）：

### 2.1 确认 MinIO 服务端信息（必知）

假设你的 MinIO 服务端信息如下（**替换为你的实际信息**）：

- 服务端 IP：`192.168.1.100`（MinIO 绑定的内网 IP）
- 服务端端口：`9000`（默认 API 端口，若修改过需对应替换）
- Access Key：`minioadmin`（默认密钥，若已修改用新密钥）
- Secret Key：`minioadmin`（默认密钥，若已修改用新密钥）

### 2.2 执行连接命令（创建服务端别名）

用 `mc alias set` 命令创建服务端别名（别名建议用 `myminio`，方便后续操作）：

```bash
mc alias set myminio http://192.168.1.100:9000 minioadmin minioadmin
```

- 命令格式：`mc alias set 别名 服务端地址 AccessKey SecretKey`

### 2.3 验证连接是否成功

```bash
mc admin info myminio
```

- 成功：输出 MinIO 服务端版本、存储容量、节点状态等信息；
- 失败：检查服务端是否启动（`systemctl status minio`）、IP / 端口是否正确、防火墙是否关闭。

## 三、步骤 3：创建 MinIO 桶（基础操作）

连接成功后，先创建一个桶（桶名需符合 DNS 规范：小写字母、数字、短横线 `-`，无特殊字符）：

### 3.1 创建普通桶

```bash
# 创建名为「my-data-bucket」的桶（替换为你的桶名）
mc mb myminio/my-data-bucket
```

- 命令说明：`mb` = make bucket（创建桶）
- 成功提示：`Bucket created successfully 'myminio/my-data-bucket'.`

### 3.2 验证桶是否创建成功

```bash
# 列出服务端所有桶
mc ls myminio
```

输出中会显示 `my-data-bucket`，说明桶创建成功。

## 四、步骤 4：桶的核心配置（无 Web 界面全程命令行）

创建桶后，按需配置权限、生命周期、跨域等，以下是内网常用配置：

### 4.1 权限配置（内网重点：限制访问范围）

避免桶被未授权访问，优先配置内网网段限制：

bash



运行









```bash
# 场景 1：仅允许指定内网网段访问（推荐，如 192.168.1.0/24 网段）
mc policy set ip="192.168.1.0/24" readwrite myminio/my-data-bucket
# 权限说明：readwrite=读写；read=仅读；write=仅写；private=仅所有者（默认）

# 场景 2：设为私有桶（仅桶所有者可访问，默认状态）
mc policy set private myminio/my-data-bucket

# 场景 3：公开读（谨慎，仅测试用）
mc policy set public myminio/my-data-bucket

# 查看当前桶权限
mc policy get myminio/my-data-bucket
```

### 4.2 生命周期管理（自动清理 / 转储文件）

配置文件自动过期、转储到低频存储，节省空间（如日志文件 30 天后删除）：

bash



运行









```bash
# 1. 创建生命周期规则文件（JSON 格式，保存为 lifecycle.json）
cat > lifecycle.json << EOF
{
  "Rules": [
    {
      "ID": "auto-delete-logs",  // 规则名称（自定义）
      "Status": "Enabled",       // 启用规则（Disabled 为禁用）
      "Prefix": "logs/",         // 仅对前缀为「logs/」的文件生效
      "Expiration": {
        "Days": 30               // 30 天后自动删除
      }
    },
    {
      "ID": "transition-to-ia",
      "Status": "Enabled",
      "Prefix": "backup/",       // 对前缀为「backup/」的文件生效
      "Transition": {
        "Days": 7,               // 7 天后转储
        "StorageClass": "STANDARD_IA"  // 转储到低频存储（MinIO 支持）
      }
    }
  ]
}
EOF

# 2. 应用生命周期规则到桶
mc ilm import myminio/my-data-bucket < lifecycle.json

# 3. 查看已配置的生命周期规则
mc ilm list myminio/my-data-bucket
```

### 4.3 跨域配置（允许前端 / 其他服务访问）

若有内网前端应用（如 Vue/React）访问桶内文件，需配置跨域：

bash



运行









```bash
# 1. 创建跨域规则文件（JSON 格式，保存为 cors.json）
cat > cors.json << EOF
{
  "CORSRules": [
    {
      "AllowedHeaders": ["*"],
      "AllowedMethods": ["GET", "PUT", "POST", "DELETE"],  // 允许的请求方法
      "AllowedOrigins": ["http://192.168.1.200"],          // 允许的前端 IP（内网前端地址）
      "MaxAgeSeconds": 3000                                // 跨域缓存时间
    }
  ]
}
EOF

# 2. 应用跨域规则到桶
mc admin config set myminio cors:my-data-bucket < cors.json

# 3. 重启 MinIO 服务使跨域生效（需先停止再启动）
systemctl stop minio
systemctl start minio

# 4. 查看跨域规则
mc admin config get myminio cors:my-data-bucket
```

### 4.4 版本控制（防止文件误删）

启用版本控制后，删除 / 修改文件会保留历史版本，可恢复：

bash



运行









```bash
# 启用版本控制
mc version enable myminio/my-data-bucket

# 禁用版本控制（仅停止新增版本，历史版本保留）
mc version disable myminio/my-data-bucket

# 查看版本控制状态
mc version status myminio/my-data-bucket
```

### 4.5 桶加密（可选，加密存储文件）

启用服务器端加密，文件存储时自动加密，访问时自动解密：

bash



运行









```bash
# 启用加密（使用 MinIO 自带密钥）
mc encrypt set server-side myminio/my-data-bucket

# 查看加密状态
mc encrypt status myminio/my-data-bucket

# 禁用加密
mc encrypt unset myminio/my-data-bucket
```

## 五、步骤 5：桶的日常管理（命令行替代 Web 界面）

后续对桶的操作（上传 / 下载文件、删除桶等），全程用 `mc` 命令：

bash



运行









```bash
# 1. 上传本地文件到桶
mc cp /local/path/file.txt myminio/my-data-bucket/path/  # 上传单个文件
mc cp -r /local/folder/ myminio/my-data-bucket/folder/   # 递归上传文件夹

# 2. 从桶下载文件到本地
mc cp myminio/my-data-bucket/file.txt /local/save/path/
mc cp -r myminio/my-data-bucket/folder/ /local/save/folder/

# 3. 列出桶内文件（含子目录）
mc ls -r myminio/my-data-bucket

# 4. 删除桶内文件/目录
mc rm myminio/my-data-bucket/file.txt  # 删除单个文件
mc rm -r myminio/my-data-bucket/folder/  # 递归删除目录

# 5. 删除桶（需先清空桶内文件）
mc rm -r myminio/my-data-bucket  # 清空桶
mc rb myminio/my-data-bucket     # 删除空桶（rb = remove bucket）
```

## 六、常见问题排查（从零操作易踩坑）

1. **`mc: command not found`**：原因：`mc` 未放在 `/usr/local/bin` 或未赋予执行权限。解决方案：`cp mc /usr/local/bin/ && chmod +x /usr/local/bin/mc`。
2. **连接 MinIO 失败（`mc admin info` 报错）**：检查 3 点：① MinIO 服务是否启动（`systemctl status minio`）；② 服务端 IP / 端口是否正确（默认 9000）；③ 防火墙是否关闭（`systemctl status firewalld` 需为 inactive）。
3. **权限配置后不生效**：原因：规则应用错误，重新执行 `mc policy set` 命令，确保网段 / 用户正确；若仍不生效，检查 MinIO 服务是否重启（部分配置需重启）。
4. **上传文件失败（`Access Denied`）**：原因：当前使用的 AccessKey 无桶的读写权限，切换为桶所有者的 AccessKey 或重新配置权限（`mc policy set ip="你的IP" readwrite 桶名`）。

## 七、核心总结（从零到配置完成流程）

1. 离线部署 `mc` 客户端 → 2. `mc alias set` 连接 MinIO 服务端 → 3. `mc mb` 创建桶 → 4. 按需配置权限 / 生命周期 / 跨域 → 5. 用 `mc cp/rm/ls` 管理文件。

全程无需 Web 界面，所有配置均通过命令行完成，适配内网无外网环境，且操作可重复执行（如规则文件可复用），适合自动化部署场景。